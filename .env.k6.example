# k6 Load Test Configuration
# Copy this file to .env.k6 and customize as needed

# =============================================================================
# TEST MODE
# =============================================================================
# Preset test modes: smoke, load, stress, soak
# Use this OR individual VU/duration settings below
TEST_MODE=load

# =============================================================================
# LOAD PATTERN (overrides TEST_MODE if specified)
# =============================================================================
# Maximum number of virtual users
MAX_VUS=100

# Duration to ramp up to MAX_VUS
RAMP_UP_DURATION=10m

# Duration to maintain MAX_VUS
STEADY_DURATION=5m

# Duration to ramp down to 0
RAMP_DOWN_DURATION=5m

# Number of intermediate ramp stages (e.g., 4 = 25%, 50%, 75%, 100%)
RAMP_STEPS=4

# Initial number of VUs at test start
START_VUS=0

# Graceful shutdown duration
GRACEFUL_STOP=30s

# =============================================================================
# API CONFIGURATION
# =============================================================================
# Base URL of the STT API
# Python service: http://localhost:8000 (or use NodePort 30654)
# Java service:   http://localhost:8080 (or use NodePort 30880)
BASE_URL=http://localhost:8000

# API endpoint path
# Python endpoints:
#   - /transcriptions/process-isolated: Default, prevents memory leaks (recommended)
#   - /transcriptions: Thread-based, has native memory leaks (for testing/comparison)
# Java endpoints:
#   - /api/v2/transcribe: Basic implementation (for memory leak comparison)
ENDPOINT=/transcriptions/process-isolated

# Request timeout in milliseconds (3 minutes)
REQUEST_TIMEOUT_MS=180000

# Target language for transcription
LANGUAGE=en-US

# =============================================================================
# WEB DASHBOARD
# =============================================================================
# Enable k6 web dashboard for real-time test visualization
# When enabled, dashboard is available at http://127.0.0.1:5665
# Reports are automatically saved to reports/k6-report-YYYY-MM-DD-HHMMSS.html
# Set to true or 1 to enable
K6_WEB_DASHBOARD=false

# Optional: Custom web dashboard host (default: 127.0.0.1:5665)
# K6_WEB_DASHBOARD_HOST=0.0.0.0:5665

# Note: K6_WEB_DASHBOARD_EXPORT is automatically set by run-load-test.sh
# with a timestamp-based filename. No need to configure manually.

# =============================================================================
# AUDIO FILES
# =============================================================================
# Use random audio files from LibriSpeech dataset
USE_RANDOM_AUDIO=true

# Directory containing LibriSpeech audio files (relative to project root)
AUDIO_DIR=samples/test-clean

# Path to audio files list JSON (relative to project root)
# This file is created by scripts/generate-audio-list.sh
# If not found, it will be generated automatically before tests
AUDIO_FILES_LIST=samples/audio-files.json

# Path to single audio file (when USE_RANDOM_AUDIO=false, relative to project root)
AUDIO_FILE_PATH=samples/sample-audio.wav

# Note: Number of audio files is controlled by MAX_AUDIO_FILES in generate-audio-list.sh
# Default is 100 random files from the dataset

# =============================================================================
# THINK TIME (delay between requests)
# =============================================================================
# Minimum think time in seconds
THINK_TIME_MIN=1

# Maximum think time in seconds
THINK_TIME_MAX=3

# =============================================================================
# THRESHOLDS
# =============================================================================
# Maximum allowed p95 response time in milliseconds
THRESHOLD_P95_DURATION=180000

# Maximum allowed error rate (0.05 = 5%)
THRESHOLD_ERROR_RATE=0.05

# =============================================================================
# LOGGING
# =============================================================================
# Enable detailed error logging
VERBOSE_ERRORS=true

# Log every Nth request (0 = disabled, 1 = all, 10 = every 10th)
LOG_SAMPLE_RATE=10
